!pip install langchain==0.0.181 openai==0.28

!cat /proc/uptime | awk '{printf("남은 시간 : %.2f", 12-$1/60/60)}'


import os 
os.environ["OPENAI_API_KEY"] = "sk-proj-k4kE94rItqW6u7FDggr5T3BlbkFJAvTRTwiP1Ls8yDzGjVS9" 


#텍스트 생성에서 번역 
prompt = '''한국어를 영어로 번역합니다. 
한국어: 나는 인공지능 모델을 만드는 개발자이다. 
영어:''' 

import openai 

response = openai.Completion.create(
    model = 'gpt-3.5-turbo-instruct', 
    prompt=prompt,
    temperature=0
)
print(response["choices"][0]["text"])

==============================
prompt = "dog dancing on car"

import openai 

response = openai.Image.create(
    prompt=prompt, 
    n=1,
    size="512x512"
)

image_url = response["data"][0]["url"]
print(image_url)

===============================
*폴더에 미리 2개의 이미지를 올려둔다.
image = open("image.png", "rb")
mask = open("mask.png", "rb")

prompt = "many apples in cardboard box"


import openai 

response = openai.Image.create_edit(
    image=image,
    mask=mask,
    prompt=prompt,
    n=1,
    size="512x512"
)

image_url = response["data"][0]["url"]
print(image_url)

==========================================

image = open("image.png", "rb")

*기존 이미지를 변형하기 
import openai 

response = openai.Image.create_variation(
    image=image,
    n=1,
    size="512x512"
)

image_url = response["data"][0]["url"]
print(image_url)


text = "이것은 테스트입니다."

import openai 

response = openai.Embedding.create(
    input=text,
    model="text-embedding-ada-002"
)

print(len(response["data"][0]["embedding"]))
print(response["data"][0]["embedding"])

*유사도 체크 
!pip install faiss-gpu

import openai 
import numpy as np 

#입력 텍스트의 임베딩 생성
in_text = "오늘은 비가 오지 않아서 다행이다."
response = openai.Embedding.create(
    input = in_text, 
    model="text-embedding-ada-002"
)
in_embeds = [record["embedding"] for record in response["data"]]
in_embeds = np.array(in_embeds).astype("float32")

#대상 텍스트의 임베딩 생성
target_texts = [
    "좋아하는 음식은 무엇인가요?",
    "어디에 살고 계신가요?",
    "아침 전철은 혼잡하네요.",
    "오늘은 날씨가 좋네요!",
    "요즘 경기가 좋지 않네요."
]

response = openai.Embedding.create(
    input = target_texts,
    model="text-embedding-ada-002"
)
target_embeds = [record["embedding"] for record in response["data"]]
target_embeds = np.array(target_embeds).astype("float32")

import faiss 

index = faiss.IndexFlatL2(1536)



index.add(target_embeds)


D, I = index.search(in_embeds, 1)

print(D)
print(I)
print(target_texts[I[0][0]])



import pandas as pd 

df = pd.read_csv('/content/tsukuyomi .csv',
    usecols=[1,2],
    names=['prompt', 'completion'],
    skiprows=2)

df.to_json(
    'tsukuyomi.jsonl',
    orient='records',
    lines=True,
    force_ascii=False
)



!openai tools fine_tunes.prepare_data -f tsukuyomi.jsonl -q 

!openai api fine_tunes.create -t "/content/tsukuyomi_prepared.jsonl" -m davinci-002


prompt = "좋아하는 음식은 무엇인가요? ->"
response = openai.Completion.create(
    model = "davinci:ft-personal-2023-03-18-02-44-09",
    prompt=prompt,
    max_tokens=100,
    stop="\n"
)
print(response["choices"][0]["text"])


response = openai.Moderation.create(
    input = "I'll kill you!"
)
print(response)



